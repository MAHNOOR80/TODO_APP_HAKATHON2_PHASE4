apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: todo-app

resources:
  - ../../base

# Production-specific labels
commonLabels:
  environment: production

# Production-specific patches
patches:
  # Production replicas
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 3
    target:
      kind: Deployment
      name: backend
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
      name: frontend

  # Enable TLS on Ingress
  - patch: |-
      - op: add
        path: /spec/tls
        value:
          - hosts:
              - todo.example.com
            secretName: todo-tls-secret
      - op: add
        path: /metadata/annotations/cert-manager.io~1cluster-issuer
        value: letsencrypt-prod
      - op: add
        path: /metadata/annotations/nginx.ingress.kubernetes.io~1ssl-redirect
        value: "true"
    target:
      kind: Ingress
      name: todo-ingress

# Production-specific ConfigMap values
configMapGenerator:
  - name: todo-config
    behavior: merge
    literals:
      - LOG_LEVEL=info
      - AGENT_INTERVAL_MS=300000

# Production images (container registry)
images:
  - name: todo-backend
    newName: ghcr.io/your-org/todo-backend
    newTag: v1.0.0
  - name: todo-frontend
    newName: ghcr.io/your-org/todo-frontend
    newTag: v1.0.0
  - name: todo-ai-agent
    newName: ghcr.io/your-org/todo-ai-agent
    newTag: v1.0.0
